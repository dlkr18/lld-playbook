classDiagram

    class Card {
        -final String cardNumber
        -final String pin
        -final String accountNumber
        +getCardNumber() String
        +validatePin() boolean
        +getAccountNumber() String
    }

    class CashDispenser {
        -Map~Integer,Integer~ cashInventory
        +canDispense() boolean
        +dispenseCash() Map<Integer, Integer>
    }

    class ATM {
        -ATMState state
        -Card currentCard
        -CashDispenser cashDispenser
        +insertCard() boolean
        +enterPIN() boolean
        +withdraw() boolean
        +ejectCard() void
    }

    class ATMState {
        <<enumeration>>
        IDLE
        CARD_INSERTED
        PIN_ENTERED
        TRANSACTION_IN_PROGRESS
    }

    class Demo {
        +main() static void
    }

    class ATMServiceImpl {
        -final Map~String,Card~ cards
        -final Map~String,Account~ accounts
        -final CashDispenser cashDispenser
        +addCard() void
        +addAccount() void
        +authenticateCard() boolean
        +checkBalance() BigDecimal
        +withdraw() boolean
        +deposit() void
        +changePin() boolean
    }

    class Card {
        -final String cardNumber
        -final String pin
        -final String accountNumber
        -final LocalDate expiryDate
        -CardStatus status
        -int failedAttempts
        +validatePin() boolean
        +isExpired() boolean
        +getCardNumber() String
        +getAccountNumber() String
        +getStatus() CardStatus
        +getFailedAttempts() int
        +block() void
        +unblock() void
    }

    class CardStatus {
        <<enumeration>>
        ACTIVE
        BLOCKED
        EXPIRED
    }

    class CashDispenser {
        -final Map~Integer,Integer~ denominations
        +dispenseCash() synchronized boolean
        +getTotalCash() BigDecimal
    }

    class Account {
        -final String accountNumber
        -BigDecimal balance
        -final AccountType type
        -final List~Transaction~ transactions
        +withdraw() synchronized boolean
        +deposit() synchronized void
        +addTransaction() synchronized void
        +getAccountNumber() String
        +getBalance() BigDecimal
        +getType() AccountType
        +getTransactions() List~Transaction~
    }

    class AccountType {
        <<enumeration>>
        SAVINGS
        CURRENT
        CREDIT
    }

    class TransactionType {
        <<enumeration>>
        DEPOSIT
        WITHDRAWAL
        TRANSFER
        PAYMENT
    }

    class Transaction {
        -final String id
        -final String accountNumber
        -final TransactionType type
        -final BigDecimal amount
        -final LocalDateTime timestamp
        -final BigDecimal balanceAfter
        +getId() String
        +getType() TransactionType
        +getAmount() BigDecimal
        +getTimestamp() LocalDateTime
        +getBalanceAfter() BigDecimal
    }

    class ATMService {
        <<interface>>
        +authenticate(card, pin) boolean
        +withdraw(amount) void
        +deposit(amount) void
        +checkBalance() BigDecimal
    }

    Transaction --> TransactionType
    Card --> CardStatus
    Account --> AccountType
    Account "1" --> "*" Transaction
    ATM --> ATMState
    ATM --> Card
    ATM --> CashDispenser
    ATMServiceImpl "1" --> "*" Card
    ATMServiceImpl "1" --> "*" Account
    ATMServiceImpl --> CashDispenser

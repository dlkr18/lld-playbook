classDiagram

    class WhatsAppDemo {
        -static final DateTimeFormatter: TIME_FORMATTER
        +main(): void
    }

    class Message {
        -MessageId: id
        -UserId: senderId
        -MessageContent: content
        -MessageType: type
        -LocalDateTime: timestamp
        -MessageStatus: status
        -MessageId: repliedToId
        -MessageId: forwardedFromId
        +getId(): MessageId
        +getSenderId(): UserId
        +getContent(): MessageContent
        +getType(): MessageType
        +getTimestamp(): LocalDateTime
        +getStatus(): MessageStatus
        +getRepliedToId(): Optional~MessageId~
        +getForwardedFromId(): Optional~MessageId~
    }

    class Participant {
        -UserId: userId
        -ParticipantRole: role
        -LocalDateTime: joinedAt
        -LocalDateTime: lastReadAt
        +getUserId(): UserId
        +getRole(): ParticipantRole
        +getJoinedAt(): LocalDateTime
        +getLastReadAt(): LocalDateTime
        +promoteToAdmin(): void
        +demoteToMember(): void
        +updateLastRead(): void
        +isAdmin(): boolean
    }

    class GroupChat {
        -GroupId: groupId
        -ChatId: chatId
        -String: name
        -String: description
        -String: groupIcon
        -Map~UserId, Participant~: participants
        -List~Message~: messages
        -LocalDateTime: createdAt
        +getId(): ChatId
        +getGroupId(): GroupId
        +getType(): ChatType
        +getParticipants(): Set<UserId>
        +isParticipant(): boolean
        +getParticipant(): Participant
        +getAllParticipants(): Set<Participant>
        +getAdmins(): Set<UserId>
    }

    class ChatType {
        <<enumeration>>
        -String: displayName
        +getDisplayName(): String
    }

    class MessageStatus {
        <<enumeration>>
        -String: displayName
        -String: symbol
        +getDisplayName(): String
        +getSymbol(): String
        +canTransitionTo(): boolean
    }

    class DirectChat {
        -ChatId: id
        -UserId: user1
        -UserId: user2
        -List~Message~: messages
        -LocalDateTime: createdAt
        -Map~UserId, LocalDateTime~: lastReadAt
        +getId(): ChatId
        +getType(): ChatType
        +getParticipants(): Set<UserId>
        +isParticipant(): boolean
        +addMessage(): void
        +getMessages(): List~Message~
        +getMessages(): List~Message~
        +getLastMessage(): Message
    }

    class MessageId {
        -String: id
        +generate(): MessageId
        +of(): MessageId
        +getValue(): String
    }

    class User {
        -UserId: id
        -String: name
        -PhoneNumber: phoneNumber
        -String: profilePicture
        -String: statusMessage
        -UserStatus: status
        -LocalDateTime: lastSeen
        -Set~UserId~: blockedUsers
        +getId(): UserId
        +getName(): String
        +getPhoneNumber(): PhoneNumber
        +getProfilePicture(): String
        +getStatusMessage(): String
        +getStatus(): UserStatus
        +getLastSeen(): LocalDateTime
        +getBlockedUsers(): Set<UserId>
    }

    class UserId {
        -String: id
        +generate(): UserId
        +of(): UserId
        +getValue(): String
    }

    class MessageContent {
        -String: text
        -Attachment: attachment
        +getText(): Optional~String~
        +getAttachment(): Optional~Attachment~
        +hasText(): boolean
        +hasAttachment(): boolean
        +inferType(): MessageType
    }

    class UserStatus {
        <<enumeration>>
        -String: displayName
        +getDisplayName(): String
    }

    class Attachment {
        -String: fileName
        -String: fileType
        -long: fileSize
        -String: url
        +getFileName(): String
        +getFileType(): String
        +getFileSize(): long
        +getUrl(): String
        +getFormattedSize(): String
    }

    class ParticipantRole {
        <<enumeration>>
        -String: displayName
        +getDisplayName(): String
        +canManageGroup(): boolean
        +canAddMembers(): boolean
        +canRemoveMembers(): boolean
    }

    class ChatId {
        -String: id
        +generate(): ChatId
        +of(): ChatId
        +getValue(): String
    }

    class MessageType {
        <<enumeration>>
        -String: displayName
        +getDisplayName(): String
        +isMedia(): boolean
    }

    class GroupId {
        -String: id
        +generate(): GroupId
        +of(): GroupId
        +getValue(): String
        +toChatId(): ChatId
    }

    class PhoneNumber {
        -static final Pattern: PHONE_PATTERN
        -String: number
        +of(): PhoneNumber
        +getValue(): String
        +getFormatted(): String
    }

    class Chat {
        <<interface>>
        +getId() ChatId
        +getType() ChatType
        +getParticipants() List~UserId~
        +addMessage(message) void
        +getMessages() List~Message~
    }

    MessageContent --> Attachment
    MessageContent --> MessageType
    GroupChat --> GroupId
    GroupChat --> ChatId
    GroupChat "1" --> "*" Participant
    GroupChat "1" --> "*" Message
    GroupChat --> ChatType
    GroupChat "1" --> "*" UserId
    GroupChat --> ParticipantRole
    Message --> MessageId
    Message --> UserId
    Message --> MessageContent
    Message --> MessageType
    Message --> MessageStatus
    GroupId --> ChatId
    DirectChat --> ChatId
    DirectChat --> UserId
    DirectChat "1" --> "*" Message
    DirectChat --> ChatType
    InMemoryChatService "1" --> "*" Chat
    InMemoryChatService "1" --> "*" GroupChat
    InMemoryChatService "1" --> "*" ChatId
    InMemoryChatService "1" --> "*" Message
    InMemoryChatService "1" --> "*" MessageId
    InMemoryChatService "1" --> "*" UserId
    InMemoryChatService --> GroupId
    InMemoryChatService --> MessageContent
    User --> UserId
    User --> PhoneNumber
    User --> UserStatus
    InMemoryUserService "1" --> "*" User
    InMemoryUserService "1" --> "*" UserId
    InMemoryUserService --> PhoneNumber
    InMemoryUserService --> UserStatus
    Participant --> UserId
    Participant --> ParticipantRole
